---
title: "subgroup analysis - detailed items"
author: "Di"
date: "2023-07-27"
output: html_document

---
```{r setup, include=FALSE}
directory_path = 'D:\\DiXi\\data preparation\\environmental info\\single events identification\\heat and cold\\using threshold 5 years prior to exposure\\revision 2\\strata prov\\stratification'
setwd(directory_path)

#knitr::opts_chunk$set(root.dir = directory_path)


knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(survival)
library(forestplot)
library(grid)
library(checkmate)
library(abind)
library(broom)
library(stringr)
```



```{r update dataset}
update_full = function(df){

  df$event.death <- ifelse(df$final_status == 'death' & month(df$dend) %in% c(1:4, 10:12), 0, df$event.death)

  df$iadl_3 = NA
  df$iadl_3[which(df$iadl.score == 8)] = 'Full function'
  df$iadl_3[which(df$iadl.score >= 9 & df$iadl.score <=16)] = 'Moderate impairment'
  df$iadl_3[which(df$iadl.score >= 17 & df$iadl.score <=24)] = 'Severe impairment'

  return(df)

}


# update_full(HW1_CMA_full) -> HW1_CMA_full
# update_full(HW2_WMO_90TH_1D_full) -> HW2_WMO_90TH_1D_full
# update_full(HW3_WMO_90TH_2D_full) -> HW3_WMO_90TH_2D_full
# update_full(HW4_WMO_90TH_3D_full) -> HW4_WMO_90TH_3D_full
# update_full(HW5_WMO_95TH_1D_full) -> HW5_WMO_95TH_1D_full
# # update_full(HW6_WMO_95TH_2D_full) -> HW6_WMO_95TH_2D_full
# # update_full(HW7_WMO_95TH_3D_full) -> HW7_WMO_95TH_3D_full
# # update_full(HW8_NOAA_10C_1D_full) -> HW8_NOAA_10C_1D_full
# # update_full(HW9_NOAA_10C_2D_full) -> HW9_NOAA_10C_2D_full
# # update_full(HW10_NOAA_10C_3D_full) -> HW10_NOAA_10C_3D_full
# gc()
# #table(HW7_WMO_95TH_3D_full$event.death)
# 
# #table(HW10_NOAA_10C_3D_full$iadl_3)
```


```{r filter id}
# HW1_CMA_full %>% filter(id %in% r2.inclu.id$id) -> HW1_CMA_full
# HW2_WMO_90TH_1D_full %>% filter(id %in% r2.inclu.id$id) -> HW2_WMO_90TH_1D_full
# HW3_WMO_90TH_2D_full %>% filter(id %in% r2.inclu.id$id) -> HW3_WMO_90TH_2D_full
# HW4_WMO_90TH_3D_full %>% filter(id %in% r2.inclu.id$id) -> HW4_WMO_90TH_3D_full
# HW5_WMO_95TH_1D_full %>% filter(id %in% r2.inclu.id$id) -> HW5_WMO_95TH_1D_full
# HW6_WMO_95TH_2D_full %>% filter(id %in% r2.inclu.id$id) -> HW6_WMO_95TH_2D_full
# HW7_WMO_95TH_3D_full %>% filter(id %in% r2.inclu.id$id) -> HW7_WMO_95TH_3D_full
# HW8_NOAA_10C_1D_full %>% filter(id %in% r2.inclu.id$id) -> HW8_NOAA_10C_1D_full
# HW9_NOAA_10C_2D_full %>% filter(id %in% r2.inclu.id$id) -> HW9_NOAA_10C_2D_full
# HW10_NOAA_10C_3D_full %>% filter(id %in% r2.inclu.id$id) -> HW10_NOAA_10C_3D_full

setwd('E:\\DiXi\\heat vulnerability')


# saveRDS(HW1_CMA_full, 'HW1_CMA_full.rds')
# saveRDS(HW2_WMO_90TH_1D_full, 'HW2_WMO_90TH_1D_full.rds')
# saveRDS(HW3_WMO_90TH_2D_full, 'HW3_WMO_90TH_2D_full.rds')
# saveRDS(HW3_WMO_90TH_3D_full, 'HW4_WMO_90TH_3D_full.rds')
# saveRDS(HW5_WMO_95TH_1D_full, 'HW5_WMO_95TH_1D_full.rds')
# saveRDS(HW6_WMO_95TH_2D_full, 'HW6_WMO_95TH_2D_full.rds')
# saveRDS(HW7_WMO_95TH_3D_full, 'HW7_WMO_95TH_3D_full.rds')
# saveRDS(HW8_NOAA_10C_1D_full, 'HW8_NOAA_10C_1D_full.rds')
# saveRDS(HW9_NOAA_10C_2D_full, 'HW9_NOAA_10C_2D_full.rds')
# saveRDS(HW10_NOAA_10C_3D_full, 'HW10_NOAA_10C_3D_full.rds')

```

```{r update IADL}
# update_IADL = function(df){
#   
#   #df$event.death <- ifelse(df$final_status == 'death' & month(df$dend) %in% c(1:4, 10:12), 0, df$event.death)
#   
#   df$iadl_3 = NA
#   df$iadl_3[which(df$iadl.score == 8)] = 'Full function'
#   df$iadl_3[which(df$iadl.score >= 9 & df$iadl.score <=16)] = 'Moderate impairment'
#   df$iadl_3[which(df$iadl.score >= 17 & df$iadl.score <=24)] = 'Severe impairment'
# 
#   return(df)
#   
# }


#update_IADL(HW1_CMA_full) -> HW1_CMA_full
# update_IADL(HW2_WMO_90TH_1D_full) -> HW2_WMO_90TH_1D_full
# update_IADL(HW3_WMO_90TH_2D_full) -> HW3_WMO_90TH_2D_full
# update_IADL(HW4_WMO_90TH_3D_full) -> HW4_WMO_90TH_3D_full
# update_IADL(HW5_WMO_95TH_1D_full) -> HW5_WMO_95TH_1D_full
# update_IADL(HW6_WMO_95TH_2D_full) -> HW6_WMO_95TH_2D_full
# update_IADL(HW7_WMO_95TH_3D_full) -> HW7_WMO_95TH_3D_full
# update_IADL(HW8_NOAA_10C_1D_full) -> HW8_NOAA_10C_1D_full
# update_IADL(HW9_NOAA_10C_2D_full) -> HW9_NOAA_10C_2D_full
# update_IADL(HW10_NOAA_10C_3D_full) -> HW10_NOAA_10C_3D_full
gc()
```


```{r}
#social_network %>% select(id, f111.code, f112.code, f113.code) -> social.items


addItems = function(df){
  
  df %>% left_join(adl_items, by = 'id') -> df
         #left_join(social.items, by = 'id') -> df
  
  return(df)
}
# 
# addItems(HW1_CMA_full) -> HW1_CMA_full
# addItems(HW2_WMO_90TH_1D_full) -> HW2_WMO_90TH_1D_full
# addItems(HW3_WMO_90TH_2D_full) -> HW3_WMO_90TH_2D_full
# addItems(HW4_WMO_90TH_3D_full) -> HW4_WMO_90TH_3D_full
# addItems(HW5_WMO_95TH_1D_full) -> HW5_WMO_95TH_1D_full
# addItems(HW6_WMO_95TH_2D_full) -> HW6_WMO_95TH_2D_full
# addItems(HW7_WMO_95TH_3D_full) -> HW7_WMO_95TH_3D_full
# addItems(HW8_NOAA_10C_1D_full) -> HW8_NOAA_10C_1D_full
# addItems(HW9_NOAA_10C_2D_full) -> HW9_NOAA_10C_2D_full
# addItems(HW10_NOAA_10C_3D_full) -> HW10_NOAA_10C_3D_full

```






```{r function get subgroup}
getSubGroup.prov = function(df, stratify_var, def){

    
  stratify_levels <- as.character(na.omit(unique(df[[stratify_var]])))
  stratify_levels <- stratify_levels[!(stratify_levels %in% c("don't know"))]#; stratify_levels
  
 
  results = list()

    for (level in stratify_levels) {
      
    
      
      subset_data <- subset(df, df[[stratify_var]] == level)
    
      # Fit the Cox model
      
      # f <- paste0('Surv(tstart, times, event.death) ~ hwd.ind + pm25.scale + ndvi.scale + rh.scale + trueage + sex + strata(region) + cluster(id)')
      f <- paste0('Surv(tstart, times, event.death) ~ hwd.ind + trueage + sex + strata(prov) + cluster(id)')
      f = as.formula(f)
      coxfit <- coxph(f, data = subset_data)
    
      # Store the model results
      result <- coxfit %>% tidy(conf.int = TRUE, exponentiate = TRUE)
      
      results[[level]] <- result
    }
    
    saveRDS(results, paste0(def, '_', stratify_var, '.rds'))
    

    
    return(results)
}
```



```{r agegroup}
#### female ####
setwd(paste0(directory_path, '\\agegroup'))

# getSubGroup.prov(HW1_CMA_full, 'agegroup', 'HW1')
# getSubGroup.prov(HW2_WMO_90TH_1D_full, 'agegroup', 'HW2')
# getSubGroup.prov(HW3_WMO_90TH_2D_full, 'agegroup', 'HW3')
# getSubGroup.prov(HW4_WMO_90TH_3D_full, 'agegroup', 'HW4')
# getSubGroup.prov(HW5_WMO_95TH_1D_full, 'agegroup', 'HW5')
# getSubGroup.prov(HW6_WMO_95TH_2D_full, 'agegroup', 'HW6')
# getSubGroup.prov(HW7_WMO_95TH_3D_full, 'agegroup', 'HW7')
# getSubGroup.prov(HW8_NOAA_10C_1D_full, 'agegroup', 'HW8')
# getSubGroup.prov(HW9_NOAA_10C_2D_full, 'agegroup', 'HW9')
# getSubGroup.prov(HW10_NOAA_10C_3D_full, 'agegroup', 'HW10')
# 
# getCSV(paste0(directory_path, '\\agegroup'))
# combineResults(paste0(directory_path, '\\agegroup'), '/70','70.csv')
# combineResults(paste0(directory_path, '\\agegroup'), '/80','80.csv')
# combineResults(paste0(directory_path, '\\agegroup'), '/90','90.csv')
# combineResults(paste0(directory_path, '\\agegroup'), '/100','100.csv')
#gc()

```


```{r sex}
#### female ####
setwd(paste0(directory_path, '\\sex'))

getSubGroup.prov(HW1_CMA_full, 'sex', 'HW1')
getSubGroup.prov(HW2_WMO_90TH_1D_full, 'sex', 'HW2')
getSubGroup.prov(HW3_WMO_90TH_2D_full, 'sex', 'HW3')
# getSubGroup.prov(HW4_WMO_90TH_3D_full, 'sex', 'HW4')
# getSubGroup.prov(HW5_WMO_95TH_1D_full, 'sex', 'HW5')
# getSubGroup.prov(HW6_WMO_95TH_2D_full, 'sex', 'HW6')
# getSubGroup.prov(HW7_WMO_95TH_3D_full, 'sex', 'HW7')
# getSubGroup.prov(HW8_NOAA_10C_1D_full, 'sex', 'HW8')
# getSubGroup.prov(HW9_NOAA_10C_2D_full, 'sex', 'HW9')
# getSubGroup.prov(HW10_NOAA_10C_3D_full, 'sex', 'HW10')

# getCSV(paste0(directory_path, '\\sex'))
# combineResults(paste0(directory_path, '\\sex'), '/female','female.csv')
# combineResults(paste0(directory_path, '\\sex'), '/male','male.csv')



```

```{r co.resi}
#### female ####
setwd(paste0(directory_path, '\\coresidence'))
gc()
# getSubGroup.prov(HW1_CMA_full, 'co.resi.baseline', 'HW1')
# getSubGroup.prov(HW2_WMO_90TH_1D_full, 'co.resi.baseline', 'HW2')
# getSubGroup.prov(HW3_WMO_90TH_2D_full, 'co.resi.baseline', 'HW3')
# getSubGroup.prov(HW4_WMO_90TH_3D_full, 'co.resi.baseline', 'HW4')
# getSubGroup.prov(HW5_WMO_95TH_1D_full, 'co.resi.baseline', 'HW5')
# getSubGroup.prov(HW6_WMO_95TH_2D_full, 'co.resi.baseline', 'HW6')
# getSubGroup.prov(HW7_WMO_95TH_3D_full, 'co.resi.baseline', 'HW7')
# getSubGroup.prov(HW8_NOAA_10C_1D_full, 'co.resi.baseline', 'HW8')
# getSubGroup.prov(HW9_NOAA_10C_2D_full, 'co.resi.baseline', 'HW9')
# getSubGroup.prov(HW10_NOAA_10C_3D_full, 'co.resi.baseline', 'HW10')

# getCSV(paste0(directory_path, '\\coresidence'))
combineResults(paste0(directory_path, '\\coresidence'), '/alone','alone.csv')
combineResults(paste0(directory_path, '\\coresidence'), '/household','household.csv')
combineResults(paste0(directory_path, '\\coresidence'), '/institution','institution.csv')


```

```{r UorR}
# gc()
#### female ####
setwd(paste0(directory_path, '\\UorR'))

# getSubGroup.prov(HW1_CMA_full, 'UorR', 'HW1')
# getSubGroup.prov(HW2_WMO_90TH_1D_full, 'UorR', 'HW2')
# getSubGroup.prov(HW3_WMO_90TH_2D_full, 'UorR', 'HW3')
# getSubGroup.prov(HW4_WMO_90TH_3D_full, 'UorR', 'HW4')
# getSubGroup.prov(HW5_WMO_95TH_1D_full, 'UorR', 'HW5')
# getSubGroup.prov(HW6_WMO_95TH_2D_full, 'UorR', 'HW6')
# getSubGroup.prov(HW7_WMO_95TH_3D_full, 'UorR', 'HW7')
# getSubGroup.prov(HW8_NOAA_10C_1D_full, 'UorR', 'HW8')
# getSubGroup.prov(HW9_NOAA_10C_2D_full, 'UorR', 'HW9')
# getSubGroup.prov(HW10_NOAA_10C_3D_full, 'UorR', 'HW10')

# getCSV(paste0(directory_path, '\\UorR'))
combineResults(paste0(directory_path, '\\UorR'), '/urban','urban.csv')
combineResults(paste0(directory_path, '\\UorR'), '/rural','rural.csv')



```

```{r marital.baseline}
# gc()
#### female ####
setwd(paste0(directory_path, '\\marital'))

# getSubGroup.prov(HW1_CMA_full, 'marital.baseline', 'HW1')
# getSubGroup.prov(HW2_WMO_90TH_1D_full, 'marital.baseline', 'HW2')
# getSubGroup.prov(HW3_WMO_90TH_2D_full, 'marital.baseline', 'HW3')
# getSubGroup.prov(HW4_WMO_90TH_3D_full, 'marital.baseline', 'HW4')
# getSubGroup.prov(HW5_WMO_95TH_1D_full, 'marital.baseline', 'HW5')
# getSubGroup.prov(HW6_WMO_95TH_2D_full, 'marital.baseline', 'HW6')
# getSubGroup.prov(HW7_WMO_95TH_3D_full, 'marital.baseline', 'HW7')
# getSubGroup.prov(HW8_NOAA_10C_1D_full, 'marital.baseline', 'HW8')
# getSubGroup.prov(HW9_NOAA_10C_2D_full, 'marital.baseline', 'HW9')
# getSubGroup.prov(HW10_NOAA_10C_3D_full, 'marital.baseline', 'HW10')

# getCSV(paste0(directory_path, '\\marital'))
combineResults(paste0(directory_path, '\\marital'), '/married','married.csv')
combineResults(paste0(directory_path, '\\marital'), '/not married','not married.csv')



```


```{r education}
# gc()
#### female ####
setwd(paste0(directory_path, '\\education'))

# getSubGroup.prov(HW1_CMA_full, 'education', 'HW1')
# getSubGroup.prov(HW2_WMO_90TH_1D_full, 'education', 'HW2')
# getSubGroup.prov(HW3_WMO_90TH_2D_full, 'education', 'HW3')
# getSubGroup.prov(HW4_WMO_90TH_3D_full, 'education', 'HW4')
# getSubGroup.prov(HW5_WMO_95TH_1D_full, 'education', 'HW5')
# getSubGroup.prov(HW6_WMO_95TH_2D_full, 'education', 'HW6')
# getSubGroup.prov(HW7_WMO_95TH_3D_full, 'education', 'HW7')
# getSubGroup.prov(HW8_NOAA_10C_1D_full, 'education', 'HW8')
# getSubGroup.prov(HW9_NOAA_10C_2D_full, 'education', 'HW9')
# getSubGroup.prov(HW10_NOAA_10C_3D_full, 'education', 'HW10')

# getCSV(paste0(directory_path, '\\education'))
combineResults(paste0(directory_path, '\\education'), '/0','0.csv')
combineResults(paste0(directory_path, '\\education'), '/1-6','1_6.csv')
combineResults(paste0(directory_path, '\\education'), '/7','7.csv')


```


```{r occupation}
# gc()
#### female ####
setwd(paste0(directory_path, '\\occupation'))

# getSubGroup.prov(HW1_CMA_full, 'occupation', 'HW1')
# getSubGroup.prov(HW2_WMO_90TH_1D_full, 'occupation', 'HW2')
# getSubGroup.prov(HW3_WMO_90TH_2D_full, 'occupation', 'HW3')
# getSubGroup.prov(HW4_WMO_90TH_3D_full, 'occupation', 'HW4')
# getSubGroup.prov(HW5_WMO_95TH_1D_full, 'occupation', 'HW5')
# getSubGroup.prov(HW6_WMO_95TH_2D_full, 'occupation', 'HW6')
# getSubGroup.prov(HW7_WMO_95TH_3D_full, 'occupation', 'HW7')
# getSubGroup.prov(HW8_NOAA_10C_1D_full, 'occupation', 'HW8')
# getSubGroup.prov(HW9_NOAA_10C_2D_full, 'occupation', 'HW9')
# getSubGroup.prov(HW10_NOAA_10C_3D_full, 'occupation', 'HW10')

names(HW1_occupation)[4] = "agriculture, forestry, animal husbandry or fishery worker"; saveRDS(HW1_occupation, 'HW1_occupation.rds')
# names(HW2_occupation)[3] = names(HW1_occupation)[4]; saveRDS(HW2_occupation, 'HW2_occupation.rds')
# names(HW3_occupation)[3] = names(HW1_occupation)[4]; saveRDS(HW3_occupation, 'HW3_occupation.rds')
# names(HW4_occupation)[3] = names(HW1_occupation)[4]; saveRDS(HW4_occupation, 'HW4_occupation.rds')
# names(HW5_occupation)[3] = names(HW1_occupation)[4]; saveRDS(HW5_occupation, 'HW5_occupation.rds')
# names(HW6_occupation)[3] = names(HW1_occupation)[4]; saveRDS(HW6_occupation, 'HW6_occupation.rds')
# names(HW7_occupation)[3] = names(HW1_occupation)[4]; saveRDS(HW7_occupation, 'HW7_occupation.rds')
# names(HW8_occupation)[3] = names(HW1_occupation)[4]; saveRDS(HW8_occupation, 'HW8_occupation.rds')
# names(HW9_occupation)[3] = names(HW1_occupation)[4]; saveRDS(HW9_occupation, 'HW9_occupation.rds')
# names(HW10_occupation)[3] = names(HW1_occupation)[4]; saveRDS(HW10_occupation, 'HW10_occupation.rds')

 getCSV(paste0(directory_path, '\\occupation'))
# combineResults(paste0(directory_path, '\\occupation'), '/0','0.csv')
# combineResults(paste0(directory_path, '\\occupation'), '/1-6','1_6.csv')
# combineResults(paste0(directory_path, '\\occupation'), '/7','7.csv')


```


```{r d71}
# gc()
#### female ####
setwd(paste0(directory_path, '\\d71'))

# getSubGroup.prov(HW1_CMA_full, 'd71', 'HW1')
# getSubGroup.prov(HW2_WMO_90TH_1D_full, 'd71', 'HW2')
# getSubGroup.prov(HW3_WMO_90TH_2D_full, 'd71', 'HW3')
# getSubGroup.prov(HW4_WMO_90TH_3D_full, 'd71', 'HW4')
# getSubGroup.prov(HW5_WMO_95TH_1D_full, 'd71', 'HW5')
# getSubGroup.prov(HW6_WMO_95TH_2D_full, 'd71', 'HW6')
# getSubGroup.prov(HW7_WMO_95TH_3D_full, 'd71', 'HW7')
# getSubGroup.prov(HW8_NOAA_10C_1D_full, 'd71', 'HW8')
# getSubGroup.prov(HW9_NOAA_10C_2D_full, 'd71', 'HW9')
# getSubGroup.prov(HW10_NOAA_10C_3D_full, 'd71', 'HW10')

# getCSV(paste0(directory_path, '\\d71'))
combineResults(paste0(directory_path, '\\d71'), '/yes','yes.csv')
combineResults(paste0(directory_path, '\\d71'), '/no','no.csv')



```

```{r d81}
# gc()
#### female ####
setwd(paste0(directory_path, '\\d81'))

# getSubGroup.prov(HW1_CMA_full, 'd81', 'HW1')
# getSubGroup.prov(HW2_WMO_90TH_1D_full, 'd81', 'HW2')
# getSubGroup.prov(HW3_WMO_90TH_2D_full, 'd81', 'HW3')
# getSubGroup.prov(HW4_WMO_90TH_3D_full, 'd81', 'HW4')
# getSubGroup.prov(HW5_WMO_95TH_1D_full, 'd81', 'HW5')
# getSubGroup.prov(HW6_WMO_95TH_2D_full, 'd81', 'HW6')
# getSubGroup.prov(HW7_WMO_95TH_3D_full, 'd81', 'HW7')
# getSubGroup.prov(HW8_NOAA_10C_1D_full, 'd81', 'HW8')
# getSubGroup.prov(HW9_NOAA_10C_2D_full, 'd81', 'HW9')
# getSubGroup.prov(HW10_NOAA_10C_3D_full, 'd81', 'HW10')

# getCSV(paste0(directory_path, '\\d81'))
combineResults(paste0(directory_path, '\\d81'), '/yes','yes.csv')
combineResults(paste0(directory_path, '\\d81'), '/no','no.csv')


```


```{r adl.status}
#### female ####
setwd(paste0(directory_path, '\\adl'))

# getSubGroup.prov(HW1_CMA_full, 'adl.status', 'HW1')
# getSubGroup.prov(HW2_WMO_90TH_1D_full, 'adl.status', 'HW2')
# getSubGroup.prov(HW3_WMO_90TH_2D_full, 'adl.status', 'HW3')
# getSubGroup.prov(HW4_WMO_90TH_3D_full, 'adl.status', 'HW4')
# getSubGroup.prov(HW5_WMO_95TH_1D_full, 'adl.status', 'HW5')
# getSubGroup.prov(HW6_WMO_95TH_2D_full, 'adl.status', 'HW6')
# getSubGroup.prov(HW7_WMO_95TH_3D_full, 'adl.status', 'HW7')
# getSubGroup.prov(HW8_NOAA_10C_1D_full, 'adl.status', 'HW8')
# getSubGroup.prov(HW9_NOAA_10C_2D_full, 'adl.status', 'HW9')
# getSubGroup.prov(HW10_NOAA_10C_3D_full, 'adl.status', 'HW10')
# 
# getCSV(paste0(directory_path, '\\adl'))
combineResults(paste0(directory_path, '\\adl'), '/full','full.csv')
combineResults(paste0(directory_path, '\\adl'), '/moderate','moderate.csv')
combineResults(paste0(directory_path, '\\adl'), '/severe','severe.csv')



```





```{r mmse}
#### female ####
setwd(paste0(directory_path, '\\mmse'))
# 
# getSubGroup.prov(HW1_CMA_full, 'mmse.status.baseline', 'HW1')
# getSubGroup.prov(HW2_WMO_90TH_1D_full, 'mmse.status.baseline', 'HW2')
# getSubGroup.prov(HW3_WMO_90TH_2D_full, 'mmse.status.baseline', 'HW3')
# getSubGroup.prov(HW4_WMO_90TH_3D_full, 'mmse.status.baseline', 'HW4')
# getSubGroup.prov(HW5_WMO_95TH_1D_full, 'mmse.status.baseline', 'HW5')
# getSubGroup.prov(HW6_WMO_95TH_2D_full, 'mmse.status.baseline', 'HW6')
# getSubGroup.prov(HW7_WMO_95TH_3D_full, 'mmse.status.baseline', 'HW7')
# getSubGroup.prov(HW8_NOAA_10C_1D_full, 'mmse.status.baseline', 'HW8')
# getSubGroup.prov(HW9_NOAA_10C_2D_full, 'mmse.status.baseline', 'HW9')
# getSubGroup.prov(HW10_NOAA_10C_3D_full, 'mmse.status.baseline', 'HW10')
# 
# getCSV(paste0(directory_path, '\\mmse'))
combineResults(paste0(directory_path, '\\mmse'), '/poor','poor.csv')
combineResults(paste0(directory_path, '\\mmse'), '/normal','normal.csv')

#gc()
```


```{r iadl.status}
# updateIADL = function(df){
# 
#   df$iadl_3 = NA
#   df$iadl_3[which(df$iadl.score == 8)] = 'Full function'
#   df$iadl_3[which(df$iadl.score >= 9 & df$iadl.score <=16)] = 'Moderate impairment'
#   df$iadl_3[which(df$iadl.score >= 17 & df$iadl.score <=24)] = 'Severe impairment'
# 
#   return(df)
# }

# updateIADL(HW1_CMA_full) -> HW1_CMA_full
# updateIADL(HW2_WMO_90TH_1D_full) -> HW2_WMO_90TH_1D_full
# updateIADL(HW3_WMO_90TH_2D_full) -> HW3_WMO_90TH_2D_full
# updateIADL(HW4_WMO_90TH_3D_full) -> HW4_WMO_90TH_3D_full
# updateIADL(HW5_WMO_95TH_1D_full) -> HW5_WMO_95TH_1D_full
# updateIADL(HW6_WMO_95TH_2D_full) -> HW6_WMO_95TH_2D_full
# updateIADL(HW7_WMO_95TH_3D_full) -> HW7_WMO_95TH_3D_full
# updateIADL(HW8_NOAA_10C_1D_full) -> HW8_NOAA_10C_1D_full
# updateIADL(HW9_NOAA_10C_2D_full) -> HW9_NOAA_10C_2D_full
# updateIADL(HW10_NOAA_10C_3D_full) -> HW10_NOAA_10C_3D_full

#### female ####
setwd(paste0(directory_path, '\\iadl'))
gc()
getSubGroup.prov(HW1_CMA_full, 'iadl_3', 'HW1')
getSubGroup.prov(HW2_WMO_90TH_1D_full, 'iadl_3', 'HW2')
getSubGroup.prov(HW3_WMO_90TH_2D_full, 'iadl_3', 'HW3')
# getSubGroup.prov(HW4_WMO_90TH_3D_full, 'iadl_3', 'HW4')
# getSubGroup.prov(HW5_WMO_95TH_1D_full, 'iadl_3', 'HW5')
# getSubGroup.prov(HW6_WMO_95TH_2D_full, 'iadl_3', 'HW6')
# getSubGroup.prov(HW7_WMO_95TH_3D_full, 'iadl_3', 'HW7')
# getSubGroup.prov(HW8_NOAA_10C_1D_full, 'iadl_3', 'HW8')
# getSubGroup.prov(HW9_NOAA_10C_2D_full, 'iadl_3', 'HW9')
# getSubGroup.prov(HW10_NOAA_10C_3D_full, 'iadl_3', 'HW10')

# getCSV(paste0(directory_path, '\\iadl'))
combineResults(paste0(directory_path, '\\iadl'), '/full','full.csv')
combineResults(paste0(directory_path, '\\iadl'), '/moderate','moderate.csv')
combineResults(paste0(directory_path, '\\iadl'), '/severe','severe.csv')
# gc()

```




===================================================================================
================================= ADL items =====================================
===================================================================================


```{r adl items - bathing}
setwd(paste0(directory_path,'\\bathing'))
# gc()
# getSubGroup.prov(HW1_CMA_full, 'bathing', 'HW1')
# getSubGroup.prov(HW2_WMO_90TH_1D_full, 'bathing', 'HW2')
# getSubGroup.prov(HW3_WMO_90TH_2D_full, 'bathing', 'HW3')
# getSubGroup.prov(HW4_WMO_90TH_3D_full, 'bathing', 'HW4')
# getSubGroup.prov(HW5_WMO_95TH_1D_full, 'bathing', 'HW5')
# getSubGroup.prov(HW6_WMO_95TH_2D_full, 'bathing', 'HW6')
# getSubGroup.prov(HW7_WMO_95TH_3D_full, 'bathing', 'HW7')
# getSubGroup.prov(HW8_NOAA_10C_1D_full, 'bathing', 'HW8')
# getSubGroup.prov(HW9_NOAA_10C_2D_full, 'bathing', 'HW9')
# getSubGroup.prov(HW10_NOAA_10C_3D_full, 'bathing', 'HW10')
# 
# getCSV(paste0(directory_path,'\\bathing'))
combineResults(paste0(directory_path,'\\bathing'), '/without assistance', 'without assistance.csv')
combineResults(paste0(directory_path,'\\bathing'), '/partial assistance','partial assistance.csv')
combineResults(paste0(directory_path,'\\bathing'), '/full assistance','full assistance.csv')
```


```{r adl items - dressing}
setwd(paste0(directory_path,'\\dressing'))
gc()
getSubGroup.prov(HW1_CMA_full, 'dressing', 'HW1')
getSubGroup.prov(HW2_WMO_90TH_1D_full, 'dressing', 'HW2')
getSubGroup.prov(HW3_WMO_90TH_2D_full, 'dressing', 'HW3')
# getSubGroup.prov(HW4_WMO_90TH_3D_full, 'dressing', 'HW4')
# getSubGroup.prov(HW5_WMO_95TH_1D_full, 'dressing', 'HW5')
# getSubGroup.prov(HW6_WMO_95TH_2D_full, 'dressing', 'HW6')
# getSubGroup.prov(HW7_WMO_95TH_3D_full, 'dressing', 'HW7')
# getSubGroup.prov(HW8_NOAA_10C_1D_full, 'dressing', 'HW8')
# getSubGroup.prov(HW9_NOAA_10C_2D_full, 'dressing', 'HW9')
# getSubGroup.prov(HW10_NOAA_10C_3D_full, 'dressing', 'HW10')
# 
# getCSV(paste0(directory_path,'\\dressing'))
# combineResults(paste0(directory_path,'\\dressing'), '/without assistance', 'without assistance.csv')
# combineResults(paste0(directory_path,'\\dressing'), '/partial assistance','partial assistance.csv')
# combineResults(paste0(directory_path,'\\dressing'), '/full assistance','full assistance.csv')
```


```{r adl items - eating}
setwd(paste0(directory_path, '\\eating'))

gc()
getSubGroup.prov(HW1_CMA_full, 'eating', 'HW1')
getSubGroup.prov(HW2_WMO_90TH_1D_full, 'eating', 'HW2')
getSubGroup.prov(HW3_WMO_90TH_2D_full, 'eating', 'HW3')
# getSubGroup.prov(HW4_WMO_90TH_3D_full, 'eating', 'HW4')
# getSubGroup.prov(HW5_WMO_95TH_1D_full, 'eating', 'HW5')
# getSubGroup.prov(HW6_WMO_95TH_2D_full, 'eating', 'HW6')
# getSubGroup.prov(HW7_WMO_95TH_3D_full, 'eating', 'HW7')
# getSubGroup.prov(HW8_NOAA_10C_1D_full, 'eating', 'HW8')
# getSubGroup.prov(HW9_NOAA_10C_2D_full, 'eating', 'HW9')
# getSubGroup.prov(HW10_NOAA_10C_3D_full, 'eating', 'HW10')
# 
# getCSV(paste0(directory_path, '\\eating'))
# combineResults(paste0(directory_path, '\\eating'), '/without assistance', 'without assistance.csv')
# combineResults(paste0(directory_path, '\\eating'), '/partial assistance','partial assistance.csv')
# combineResults(paste0(directory_path, '\\eating'), '/full assistance','full assistance.csv')
```

```{r adl items - toileting}
setwd(paste0(directory_path, '\\toileting'))
gc()
getSubGroup.prov(HW1_CMA_full, 'toileting', 'HW1')
getSubGroup.prov(HW2_WMO_90TH_1D_full, 'toileting', 'HW2')
getSubGroup.prov(HW3_WMO_90TH_2D_full, 'toileting', 'HW3')
# getSubGroup.prov(HW4_WMO_90TH_3D_full, 'toileting', 'HW4')
# getSubGroup.prov(HW5_WMO_95TH_1D_full, 'toileting', 'HW5')
# getSubGroup.prov(HW6_WMO_95TH_2D_full, 'toileting', 'HW6')
# getSubGroup.prov(HW7_WMO_95TH_3D_full, 'toileting', 'HW7')
# getSubGroup.prov(HW8_NOAA_10C_1D_full, 'toileting', 'HW8')
# getSubGroup.prov(HW9_NOAA_10C_2D_full, 'toileting', 'HW9')
# getSubGroup.prov(HW10_NOAA_10C_3D_full, 'toileting', 'HW10')
# 
# getCSV(paste0(directory_path, '\\toileting'))
# combineResults(paste0(directory_path, '\\toileting'), '/without assistance', 'without assistance.csv')
# combineResults(paste0(directory_path, '\\toileting'), '/partial assistance','partial assistance.csv')
# combineResults(paste0(directory_path, '\\toileting'), '/full assistance','full assistance.csv')
```



```{r adl items - indoormoving}
setwd(paste0(directory_path, '\\indoormoving'))

getSubGroup.prov(HW1_CMA_full, 'indoormoving', 'HW1')
getSubGroup.prov(HW2_WMO_90TH_1D_full, 'indoormoving', 'HW2')
getSubGroup.prov(HW3_WMO_90TH_2D_full, 'indoormoving', 'HW3')
# getSubGroup.prov(HW4_WMO_90TH_3D_full, 'indoormoving', 'HW4')
# getSubGroup.prov(HW5_WMO_95TH_1D_full, 'indoormoving', 'HW5')
# getSubGroup.prov(HW6_WMO_95TH_2D_full, 'indoormoving', 'HW6')
# getSubGroup.prov(HW7_WMO_95TH_3D_full, 'indoormoving', 'HW7')
# getSubGroup.prov(HW8_NOAA_10C_1D_full, 'indoormoving', 'HW8')
# getSubGroup.prov(HW9_NOAA_10C_2D_full, 'indoormoving', 'HW9')
# getSubGroup.prov(HW10_NOAA_10C_3D_full, 'indoormoving', 'HW10')
# 
# getCSV(paste0(directory_path, '\\indoormoving'))
# combineResults(paste0(directory_path, '\\indoormoving'), '/without assistance', 'without assistance.csv')
# combineResults(paste0(directory_path, '\\indoormoving'), '/partial assistance','partial assistance.csv')
# combineResults(paste0(directory_path, '\\indoormoving'), '/full assistance','full assistance.csv')
```


```{r adl items - continence}
setwd(paste0(directory_path, '\\continence'))
gc()
getSubGroup.prov(HW1_CMA_full, 'continence', 'HW1')
getSubGroup.prov(HW2_WMO_90TH_1D_full, 'continence', 'HW2')
getSubGroup.prov(HW3_WMO_90TH_2D_full, 'continence', 'HW3')
# getSubGroup.prov(HW4_WMO_90TH_3D_full, 'continence', 'HW4')
# getSubGroup.prov(HW5_WMO_95TH_1D_full, 'continence', 'HW5')
# getSubGroup.prov(HW6_WMO_95TH_2D_full, 'continence', 'HW6')
# getSubGroup.prov(HW7_WMO_95TH_3D_full, 'continence', 'HW7')
# getSubGroup.prov(HW8_NOAA_10C_1D_full, 'continence', 'HW8')
# getSubGroup.prov(HW9_NOAA_10C_2D_full, 'continence', 'HW9')
# getSubGroup.prov(HW10_NOAA_10C_3D_full, 'continence', 'HW10')
# 
# 
# getCSV(paste0(directory_path, '\\continence'))
# combineResults(paste0(directory_path, '\\continence'), '/without assistance', 'without assistance.csv')
# combineResults(paste0(directory_path, '\\continence'), '/partial assistance','partial assistance.csv')
# combineResults(paste0(directory_path, '\\continence'), '/full assistance','full assistance.csv')
```






###########################################################################
######################### IADL ITEMS#######################################
###########################################################################
```{r iadl items - neighbour}
setwd(paste0(directory_path, '\\iadl items\\neighbour'))

# getSubGroup.prov(HW1_CMA_full, 'neighbour', 'HW1')
# getSubGroup.prov(HW2_WMO_90TH_1D_full, 'neighbour', 'HW2')
# getSubGroup.prov(HW3_WMO_90TH_2D_full, 'neighbour', 'HW3')
# getSubGroup.prov(HW4_WMO_90TH_3D_full, 'neighbour', 'HW4')
# getSubGroup.prov(HW5_WMO_95TH_1D_full, 'neighbour', 'HW5')
# getSubGroup.prov(HW6_WMO_95TH_2D_full, 'neighbour', 'HW6')
# getSubGroup.prov(HW7_WMO_95TH_3D_full, 'neighbour', 'HW7')
# getSubGroup.prov(HW8_NOAA_10C_1D_full, 'neighbour', 'HW8')
# getSubGroup.prov(HW9_NOAA_10C_2D_full, 'neighbour', 'HW9')
# getSubGroup.prov(HW10_NOAA_10C_3D_full, 'neighbour', 'HW10')
# 
# getCSV(paste0(directory_path, '\\iadl items\\neighbour'))
combineResults(paste0(directory_path, '\\iadl items\\neighbour'), '/without assistance', 'without assistance.csv')
combineResults(paste0(directory_path, '\\iadl items\\neighbour'), '/partial assistance','partial assistance.csv')
combineResults(paste0(directory_path, '\\iadl items\\neighbour'), '/full assistance','full assistance.csv')
```


```{r iadl items - laundry}
gc()
setwd(paste0(directory_path, '\\iadl items\\laundry'))

# getSubGroup.prov(HW1_CMA_full, 'laundry', 'HW1')
# getSubGroup.prov(HW2_WMO_90TH_1D_full, 'laundry', 'HW2')
# getSubGroup.prov(HW3_WMO_90TH_2D_full, 'laundry', 'HW3')
# getSubGroup.prov(HW4_WMO_90TH_3D_full, 'laundry', 'HW4')
# getSubGroup.prov(HW5_WMO_95TH_1D_full, 'laundry', 'HW5')
# getSubGroup.prov(HW6_WMO_95TH_2D_full, 'laundry', 'HW6')
# getSubGroup.prov(HW7_WMO_95TH_3D_full, 'laundry', 'HW7')
# getSubGroup.prov(HW8_NOAA_10C_1D_full, 'laundry', 'HW8')
# getSubGroup.prov(HW9_NOAA_10C_2D_full, 'laundry', 'HW9')
# getSubGroup.prov(HW10_NOAA_10C_3D_full, 'laundry', 'HW10')
# 
# getCSV(paste0(directory_path, '\\iadl items\\laundry'))
combineResults(paste0(directory_path, '\\iadl items\\laundry'), '/1', 'without assistance.csv')
combineResults(paste0(directory_path, '\\iadl items\\laundry'), '/2','partial assistance.csv')
combineResults(paste0(directory_path, '\\iadl items\\laundry'), '/3','full assistance.csv')
```


```{r iadl items - cooking}
gc()
setwd(paste0(directory_path, '\\iadl items\\cooking'))

# getSubGroup.prov(HW1_CMA_full, 'cooking', 'HW1')
# getSubGroup.prov(HW2_WMO_90TH_1D_full, 'cooking', 'HW2')
# getSubGroup.prov(HW3_WMO_90TH_2D_full, 'cooking', 'HW3')
# getSubGroup.prov(HW4_WMO_90TH_3D_full, 'cooking', 'HW4')
# getSubGroup.prov(HW5_WMO_95TH_1D_full, 'cooking', 'HW5')
# getSubGroup.prov(HW6_WMO_95TH_2D_full, 'cooking', 'HW6')
# getSubGroup.prov(HW7_WMO_95TH_3D_full, 'cooking', 'HW7')
# getSubGroup.prov(HW8_NOAA_10C_1D_full, 'cooking', 'HW8')
# getSubGroup.prov(HW9_NOAA_10C_2D_full, 'cooking', 'HW9')
# getSubGroup.prov(HW10_NOAA_10C_3D_full, 'cooking', 'HW10')
# 
# getCSV(paste0(directory_path, '\\iadl items\\cooking'))
combineResults(paste0(directory_path, '\\iadl items\\cooking'), '/1', 'without assistance.csv')
combineResults(paste0(directory_path, '\\iadl items\\cooking'), '/2','partial assistance.csv')
combineResults(paste0(directory_path, '\\iadl items\\cooking'), '/3','full assistance.csv')
```


```{r iadl items - carry5kg}

setwd(paste0(directory_path, '\\iadl items\\carry5kg'))

# getSubGroup.prov(HW1_CMA_full, 'carry5kg', 'HW1')
# getSubGroup.prov(HW2_WMO_90TH_1D_full, 'carry5kg', 'HW2')
# getSubGroup.prov(HW3_WMO_90TH_2D_full, 'carry5kg', 'HW3')
# getSubGroup.prov(HW4_WMO_90TH_3D_full, 'carry5kg', 'HW4')
# getSubGroup.prov(HW5_WMO_95TH_1D_full, 'carry5kg', 'HW5')
# getSubGroup.prov(HW6_WMO_95TH_2D_full, 'carry5kg', 'HW6')
# getSubGroup.prov(HW7_WMO_95TH_3D_full, 'carry5kg', 'HW7')
# getSubGroup.prov(HW8_NOAA_10C_1D_full, 'carry5kg', 'HW8')
# getSubGroup.prov(HW9_NOAA_10C_2D_full, 'carry5kg', 'HW9')
# getSubGroup.prov(HW10_NOAA_10C_3D_full, 'carry5kg', 'HW10')

# getCSV(paste0(directory_path, '\\iadl items\\carry5kg'))
combineResults(paste0(directory_path, '\\iadl items\\carry5kg'), '/1', 'without assistance.csv')
combineResults(paste0(directory_path, '\\iadl items\\carry5kg'), '/2','partial assistance.csv')
combineResults(paste0(directory_path, '\\iadl items\\carry5kg'), '/3','full assistance.csv')
```



```{r iadl items - walk1km}
# gc()
setwd(paste0(directory_path, '\\iadl items\\walk1km'))


# getSubGroup.prov(HW1_CMA_full, 'walk1km', 'HW1')
# getSubGroup.prov(HW2_WMO_90TH_1D_full, 'walk1km', 'HW2')
# getSubGroup.prov(HW3_WMO_90TH_2D_full, 'walk1km', 'HW3')
# getSubGroup.prov(HW4_WMO_90TH_3D_full, 'walk1km', 'HW4')
# getSubGroup.prov(HW5_WMO_95TH_1D_full, 'walk1km', 'HW5')
# getSubGroup.prov(HW6_WMO_95TH_2D_full, 'walk1km', 'HW6')
# getSubGroup.prov(HW7_WMO_95TH_3D_full, 'walk1km', 'HW7')
# getSubGroup.prov(HW8_NOAA_10C_1D_full, 'walk1km', 'HW8')
# getSubGroup.prov(HW9_NOAA_10C_2D_full, 'walk1km', 'HW9')
# getSubGroup.prov(HW10_NOAA_10C_3D_full, 'walk1km', 'HW10')

# getCSV(paste0(directory_path, '\\iadl items\\walk1km'))
combineResults(paste0(directory_path, '\\iadl items\\walk1km'), '/1', 'without assistance.csv')
combineResults(paste0(directory_path, '\\iadl items\\walk1km'), '/2','partial assistance.csv')
combineResults(paste0(directory_path, '\\iadl items\\walk1km'), '/3','full assistance.csv')
```



```{r iadl items - crouch}
setwd(paste0(directory_path, '\\iadl items\\crouch'))

# getSubGroup.prov(HW1_CMA_full, 'crouch', 'HW1')
# getSubGroup.prov(HW2_WMO_90TH_1D_full, 'crouch', 'HW2')
# getSubGroup.prov(HW3_WMO_90TH_2D_full, 'crouch', 'HW3')
# getSubGroup.prov(HW4_WMO_90TH_3D_full, 'crouch', 'HW4')
# getSubGroup.prov(HW5_WMO_95TH_1D_full, 'crouch', 'HW5')
# getSubGroup.prov(HW6_WMO_95TH_2D_full, 'crouch', 'HW6')
# getSubGroup.prov(HW7_WMO_95TH_3D_full, 'crouch', 'HW7')
# getSubGroup.prov(HW8_NOAA_10C_1D_full, 'crouch', 'HW8')
# getSubGroup.prov(HW9_NOAA_10C_2D_full, 'crouch', 'HW9')
# getSubGroup.prov(HW10_NOAA_10C_3D_full, 'crouch', 'HW10')

# getCSV(paste0(directory_path, '\\iadl items\\crouch'))
combineResults(paste0(directory_path, '\\iadl items\\crouch'), '/1', 'without assistance.csv')
combineResults(paste0(directory_path, '\\iadl items\\crouch'), '/2','partial assistance.csv')
combineResults(paste0(directory_path, '\\iadl items\\crouch'), '/3','full assistance.csv')
```



```{r iadl items - shopping}

setwd(paste0(directory_path, '\\iadl items\\shopping'))

# getSubGroup.prov(HW1_CMA_full, 'shopping', 'HW1')
# getSubGroup.prov(HW2_WMO_90TH_1D_full, 'shopping', 'HW2')
# getSubGroup.prov(HW3_WMO_90TH_2D_full, 'shopping', 'HW3')
# getSubGroup.prov(HW4_WMO_90TH_3D_full, 'shopping', 'HW4')
# getSubGroup.prov(HW5_WMO_95TH_1D_full, 'shopping', 'HW5')
# getSubGroup.prov(HW6_WMO_95TH_2D_full, 'shopping', 'HW6')
# getSubGroup.prov(HW7_WMO_95TH_3D_full, 'shopping', 'HW7')
# getSubGroup.prov(HW8_NOAA_10C_1D_full, 'shopping', 'HW8')
# getSubGroup.prov(HW9_NOAA_10C_2D_full, 'shopping', 'HW9')
# getSubGroup.prov(HW10_NOAA_10C_3D_full, 'shopping', 'HW10')

# getCSV(paste0(directory_path, '\\iadl items\\shopping'))
combineResults(paste0(directory_path, '\\iadl items\\shopping'), '/1', 'without assistance.csv')
combineResults(paste0(directory_path, '\\iadl items\\shopping'), '/2','partial assistance.csv')
combineResults(paste0(directory_path, '\\iadl items\\shopping'), '/3','full assistance.csv')
```


```{r iadl items - transfer}
setwd(paste0(directory_path, '\\iadl items\\transfer'))

# getSubGroup.prov(HW1_CMA_full, 'transfer', 'HW1')
# getSubGroup.prov(HW2_WMO_90TH_1D_full, 'transfer', 'HW2')
# getSubGroup.prov(HW3_WMO_90TH_2D_full, 'transfer', 'HW3')
# getSubGroup.prov(HW4_WMO_90TH_3D_full, 'transfer', 'HW4')
# getSubGroup.prov(HW5_WMO_95TH_1D_full, 'transfer', 'HW5')
# getSubGroup.prov(HW6_WMO_95TH_2D_full, 'transfer', 'HW6')
# getSubGroup.prov(HW7_WMO_95TH_3D_full, 'transfer', 'HW7')
# getSubGroup.prov(HW8_NOAA_10C_1D_full, 'transfer', 'HW8')
# getSubGroup.prov(HW9_NOAA_10C_2D_full, 'transfer', 'HW9')
# getSubGroup.prov(HW10_NOAA_10C_3D_full, 'transfer', 'HW10')

# getCSV(paste0(directory_path, '\\iadl items\\transfer'))
combineResults(paste0(directory_path, '\\iadl items\\transfer'), '/1', 'without assistance.csv')
combineResults(paste0(directory_path, '\\iadl items\\transfer'), '/2','partial assistance.csv')
combineResults(paste0(directory_path, '\\iadl items\\transfer'), '/3','full assistance.csv')
```

###########################################################################
######################### MMSE ITEMS#######################################
###########################################################################

```{R split into tertiles}
getItemTertiles = function(df){
  
  df %>%
  mutate(orientation_binary = ifelse(orientation >= median(orientation), "better", "worse"),
    registration_binary = ifelse(registration >= median(registration), "better", "worse"),
    calculation_binary = ifelse(calculation >= median(calculation), "better", "worse"),
    recall_binary = ifelse(recall >= median(recall), "better", "worse"),
    language_binary = ifelse(language >= median(language), "better", "worse")
         
         ) -> df
  
  return(df)
}



# getItemTertiles(HW1_CMA_full) -> HW1_CMA_full
# getItemTertiles(HW2_WMO_90TH_1D_full) -> HW2_WMO_90TH_1D_full
# getItemTertiles(HW3_WMO_90TH_2D_full) -> HW3_WMO_90TH_2D_full
# getItemTertiles(HW4_WMO_90TH_3D_full) -> HW4_WMO_90TH_3D_full
# getItemTertiles(HW5_WMO_95TH_1D_full) -> HW5_WMO_95TH_1D_full
# getItemTertiles(HW6_WMO_95TH_2D_full) -> HW6_WMO_95TH_2D_full
# getItemTertiles(HW7_WMO_95TH_3D_full) -> HW7_WMO_95TH_3D_full
# getItemTertiles(HW8_NOAA_10C_1D_full) -> HW8_NOAA_10C_1D_full
# getItemTertiles(HW9_NOAA_10C_2D_full) -> HW9_NOAA_10C_2D_full
# getItemTertiles(HW10_NOAA_10C_3D_full) -> HW10_NOAA_10C_3D_full

#head(HW6_WMO_95TH_2D_full)
```


```{r calculation}
setwd(paste0(directory_path, '\\MMSE items\\calculation'))

# getSubGroup.prov(HW1_CMA_full, 'calculation_binary', 'HW1')
# getSubGroup.prov(HW2_WMO_90TH_1D_full, 'calculation_binary', 'HW2')
# getSubGroup.prov(HW3_WMO_90TH_2D_full, 'calculation_binary', 'HW3')
# getSubGroup.prov(HW4_WMO_90TH_3D_full, 'calculation_binary', 'HW4')
# getSubGroup.prov(HW5_WMO_95TH_1D_full, 'calculation_binary', 'HW5')
# getSubGroup.prov(HW6_WMO_95TH_2D_full, 'calculation_binary', 'HW6')
# getSubGroup.prov(HW7_WMO_95TH_3D_full, 'calculation_binary', 'HW7')
# getSubGroup.prov(HW8_NOAA_10C_1D_full, 'calculation_binary', 'HW8')
# getSubGroup.prov(HW9_NOAA_10C_2D_full, 'calculation_binary', 'HW9')
# getSubGroup.prov(HW10_NOAA_10C_3D_full, 'calculation_binary', 'HW10')


# getCSV(paste0(directory_path, '\\MMSE items\\calculation'))
combineResults(paste0(directory_path, '\\MMSE items\\calculation'), '/better','better.csv')
combineResults(paste0(directory_path, '\\MMSE items\\calculation'), '/worse','worse.csv')

```


```{r orientation}
setwd(paste0(directory_path, '\\MMSE items\\orientation'))
# gc()
# getSubGroup.prov(HW1_CMA_full, 'orientation_binary', 'HW1')
# getSubGroup.prov(HW2_WMO_90TH_1D_full, 'orientation_binary', 'HW2')
# getSubGroup.prov(HW3_WMO_90TH_2D_full, 'orientation_binary', 'HW3')
# getSubGroup.prov(HW4_WMO_90TH_3D_full, 'orientation_binary', 'HW4')
# getSubGroup.prov(HW5_WMO_95TH_1D_full, 'orientation_binary', 'HW5')
# getSubGroup.prov(HW6_WMO_95TH_2D_full, 'orientation_binary', 'HW6')
# getSubGroup.prov(HW7_WMO_95TH_3D_full, 'orientation_binary', 'HW7')
# getSubGroup.prov(HW8_NOAA_10C_1D_full, 'orientation_binary', 'HW8')
# getSubGroup.prov(HW9_NOAA_10C_2D_full, 'orientation_binary', 'HW9')
# getSubGroup.prov(HW10_NOAA_10C_3D_full, 'orientation_binary', 'HW10')

# getCSV(paste0(directory_path, '\\MMSE items\\orientation'))
combineResults(paste0(directory_path, '\\MMSE items\\orientation'), '/better','better.csv')
combineResults(paste0(directory_path, '\\MMSE items\\orientation'), '/worse','worse.csv')
```




```{r registration}
setwd(paste0(directory_path, '\\MMSE items\\registration'))
# gc()
# getSubGroup.prov(HW1_CMA_full, 'registration_binary', 'HW1')
# getSubGroup.prov(HW2_WMO_90TH_1D_full, 'registration_binary', 'HW2')
# getSubGroup.prov(HW3_WMO_90TH_2D_full, 'registration_binary', 'HW3')
# getSubGroup.prov(HW4_WMO_90TH_3D_full, 'registration_binary', 'HW4')
# getSubGroup.prov(HW5_WMO_95TH_1D_full, 'registration_binary', 'HW5')
# getSubGroup.prov(HW6_WMO_95TH_2D_full, 'registration_binary', 'HW6')
# getSubGroup.prov(HW7_WMO_95TH_3D_full, 'registration_binary', 'HW7')
# getSubGroup.prov(HW8_NOAA_10C_1D_full, 'registration_binary', 'HW8')
# getSubGroup.prov(HW9_NOAA_10C_2D_full, 'registration_binary', 'HW9')
# getSubGroup.prov(HW10_NOAA_10C_3D_full, 'registration_binary', 'HW10')

# getCSV(paste0(directory_path, '\\MMSE items\\registration'))
combineResults(paste0(directory_path, '\\MMSE items\\registration'), '/better','better.csv')
combineResults(paste0(directory_path, '\\MMSE items\\registration'), '/worse','worse.csv')
```


```{r recall}
setwd(paste0(directory_path, '\\MMSE items\\recall'))

# getSubGroup.prov(HW1_CMA_full, 'recall_binary', 'HW1')
# getSubGroup.prov(HW2_WMO_90TH_1D_full, 'recall_binary', 'HW2')
# getSubGroup.prov(HW3_WMO_90TH_2D_full, 'recall_binary', 'HW3')
# getSubGroup.prov(HW4_WMO_90TH_3D_full, 'recall_binary', 'HW4')
# getSubGroup.prov(HW5_WMO_95TH_1D_full, 'recall_binary', 'HW5')
# getSubGroup.prov(HW6_WMO_95TH_2D_full, 'recall_binary', 'HW6')
# getSubGroup.prov(HW7_WMO_95TH_3D_full, 'recall_binary', 'HW7')
# getSubGroup.prov(HW8_NOAA_10C_1D_full, 'recall_binary', 'HW8')
# getSubGroup.prov(HW9_NOAA_10C_2D_full, 'recall_binary', 'HW9')
# getSubGroup.prov(HW10_NOAA_10C_3D_full, 'recall_binary', 'HW10')


# getCSV(paste0(directory_path, '\\MMSE items\\recall'))
combineResults(paste0(directory_path, '\\MMSE items\\recall'), '/better','better.csv')
combineResults(paste0(directory_path, '\\MMSE items\\recall'), '/worse','worse.csv')
```



```{r language}

setwd(paste0(directory_path, '\\MMSE items\\language'))

# getSubGroup.prov(HW1_CMA_full, 'language_binary', 'HW1')
# getSubGroup.prov(HW2_WMO_90TH_1D_full, 'language_binary', 'HW2')
# getSubGroup.prov(HW3_WMO_90TH_2D_full, 'language_binary', 'HW3')
# getSubGroup.prov(HW4_WMO_90TH_3D_full, 'language_binary', 'HW4')
# getSubGroup.prov(HW5_WMO_95TH_1D_full, 'language_binary', 'HW5')
# getSubGroup.prov(HW6_WMO_95TH_2D_full, 'language_binary', 'HW6')
# getSubGroup.prov(HW7_WMO_95TH_3D_full, 'language_binary', 'HW7')
# getSubGroup.prov(HW8_NOAA_10C_1D_full, 'language_binary', 'HW8')
# getSubGroup.prov(HW9_NOAA_10C_2D_full, 'language_binary', 'HW9')
# getSubGroup.prov(HW10_NOAA_10C_3D_full, 'language_binary', 'HW10')


# getCSV(paste0(directory_path, '\\MMSE items\\language'))
combineResults(paste0(directory_path, '\\MMSE items\\language'), '/better','better.csv')
combineResults(paste0(directory_path, '\\MMSE items\\language'), '/worse','worse.csv')
```












#####################################################################################################
############################## ADL binary stratification ############################################
#####################################################################################################
```{r get binary adl}

head(adl.baseline)
colnames(adl.baseline)
factor_levels = c(1, 2, 3)
factor_labels = c('without assistance', 'need assistance', 'need assistance')

adl.baseline %>% select('id', 'bathing', 'dressing', 'toileting', 'indoormoving', 'continence', 'eating') %>% 
                 mutate(across(-id, ~ factor(., levels = factor_levels, 
                                                labels = factor_labels )))-> adl.items
head(adl.items)
colnames(adl.items) = c('id', 'bathing2', 'dressing2', 'toileting2', 'indoormoving2', 'continence2', 'eating2')


adl.items$id = as.factor(adl.items$id)


mergeItems = function(df){
  
  df %>% left_join(adl.items, by = 'id')  -> df
  
  return(df)
  
}

colnames(HW7_WMO_95TH_3D_full)
mergeItems(HW1_CMA_full) -> HW1_CMA_full
mergeItems(HW2_WMO_90TH_1D_full) -> HW2_WMO_90TH_1D_full
mergeItems(HW3_WMO_90TH_2D_full) -> HW3_WMO_90TH_2D_full
mergeItems(HW4_WMO_90TH_3D_full) -> HW4_WMO_90TH_3D_full
mergeItems(HW5_WMO_95TH_1D_full) -> HW5_WMO_95TH_1D_full
mergeItems(HW6_WMO_95TH_2D_full) -> HW6_WMO_95TH_2D_full
mergeItems(HW7_WMO_95TH_3D_full) -> HW7_WMO_95TH_3D_full
mergeItems(HW8_NOAA_10C_1D_full) -> HW8_NOAA_10C_1D_full
mergeItems(HW9_NOAA_10C_2D_full) -> HW9_NOAA_10C_2D_full
mergeItems(HW10_NOAA_10C_3D_full) -> HW10_NOAA_10C_3D_full

table(HW7_WMO_95TH_3D_full$dressing)
```




```{r adl items - bathing}
directory_path <- 'D:\\DiXi\\data preparation\\environmental info\\single events identification\\heat and cold\\using threshold 5 years prior to exposure\\modelling\\result\\subgroup analysis\\detailed items\\ADL2\\bathing'
setwd(directory_path)
# 
getSubGroup.prov(HW1_CMA_full, 'bathing', 'HW1')
getSubGroup.prov(HW2_WMO_90TH_1D_full, 'bathing', 'HW2')
getSubGroup.prov(HW3_WMO_90TH_2D_full, 'bathing', 'HW3')
getSubGroup.prov(HW4_WMO_90TH_3D_full, 'bathing', 'HW4')
getSubGroup.prov(HW5_WMO_95TH_1D_full, 'bathing', 'HW5')
getSubGroup.prov(HW6_WMO_95TH_2D_full, 'bathing', 'HW6')
getSubGroup.prov(HW7_WMO_95TH_3D_full, 'bathing', 'HW7')
getSubGroup.prov(HW8_NOAA_10C_1D_full, 'bathing', 'HW8')
getSubGroup.prov(HW9_NOAA_10C_2D_full, 'bathing', 'HW9')
getSubGroup.prov(HW10_NOAA_10C_3D_full, 'bathing', 'HW10')

getCSV(directory_path)
# combineResults(directory_path, '/without assistance', 'without assistance.csv')
# combineResults(directory_path, '/need assistance','need assistance.csv')
```


```{r adl items - dressing}
directory_path <- 'D:\\DiXi\\data preparation\\environmental info\\single events identification\\heat and cold\\using threshold 5 years prior to exposure\\modelling\\result\\subgroup analysis\\detailed items\\ADL2\\dressing'
setwd(directory_path)

getSubGroup.prov(HW1_CMA_full, 'dressing', 'HW1')
getSubGroup.prov(HW2_WMO_90TH_1D_full, 'dressing', 'HW2')
getSubGroup.prov(HW3_WMO_90TH_2D_full, 'dressing', 'HW3')
getSubGroup.prov(HW4_WMO_90TH_3D_full, 'dressing', 'HW4')
getSubGroup.prov(HW5_WMO_95TH_1D_full, 'dressing', 'HW5')
getSubGroup.prov(HW6_WMO_95TH_2D_full, 'dressing', 'HW6')
getSubGroup.prov(HW7_WMO_95TH_3D_full, 'dressing', 'HW7')
getSubGroup.prov(HW8_NOAA_10C_1D_full, 'dressing', 'HW8')
getSubGroup.prov(HW9_NOAA_10C_2D_full, 'dressing', 'HW9')
getSubGroup.prov(HW10_NOAA_10C_3D_full, 'dressing', 'HW10')

getCSV(directory_path)
# combineResults(directory_path, '/without assistance', 'without assistance.csv')
# combineResults(directory_path, '/need assistance','need assistance.csv')
```


```{r adl items - eating}
directory_path <- 'D:\\DiXi\\data preparation\\environmental info\\single events identification\\heat and cold\\using threshold 5 years prior to exposure\\modelling\\result\\subgroup analysis\\detailed items\\ADL2\\eating'
setwd(directory_path)

getSubGroup.prov(HW1_CMA_full, 'eating', 'HW1')
getSubGroup.prov(HW2_WMO_90TH_1D_full, 'eating', 'HW2')
getSubGroup.prov(HW3_WMO_90TH_2D_full, 'eating', 'HW3')
getSubGroup.prov(HW4_WMO_90TH_3D_full, 'eating', 'HW4')
getSubGroup.prov(HW5_WMO_95TH_1D_full, 'eating', 'HW5')
getSubGroup.prov(HW6_WMO_95TH_2D_full, 'eating', 'HW6')
getSubGroup.prov(HW7_WMO_95TH_3D_full, 'eating', 'HW7')
getSubGroup.prov(HW8_NOAA_10C_1D_full, 'eating', 'HW8')
getSubGroup.prov(HW9_NOAA_10C_2D_full, 'eating', 'HW9')
getSubGroup.prov(HW10_NOAA_10C_3D_full, 'eating', 'HW10')

getCSV(directory_path)
# combineResults(directory_path, '/without assistance', 'without assistance.csv')
# combineResults(directory_path, '/need assistance','need assistance.csv')
```

```{r adl items - toileting}
directory_path <- 'D:\\DiXi\\data preparation\\environmental info\\single events identification\\heat and cold\\using threshold 5 years prior to exposure\\modelling\\result\\subgroup analysis\\detailed items\\ADL2\\toileting'
setwd(directory_path)

getSubGroup.prov(HW1_CMA_full, 'toileting', 'HW1')
getSubGroup.prov(HW2_WMO_90TH_1D_full, 'toileting', 'HW2')
getSubGroup.prov(HW3_WMO_90TH_2D_full, 'toileting', 'HW3')
getSubGroup.prov(HW4_WMO_90TH_3D_full, 'toileting', 'HW4')
getSubGroup.prov(HW5_WMO_95TH_1D_full, 'toileting', 'HW5')
getSubGroup.prov(HW6_WMO_95TH_2D_full, 'toileting', 'HW6')
getSubGroup.prov(HW7_WMO_95TH_3D_full, 'toileting', 'HW7')
getSubGroup.prov(HW8_NOAA_10C_1D_full, 'toileting', 'HW8')
getSubGroup.prov(HW9_NOAA_10C_2D_full, 'toileting', 'HW9')
getSubGroup.prov(HW10_NOAA_10C_3D_full, 'toileting', 'HW10')

getCSV(directory_path)
# combineResults(directory_path, '/without assistance', 'without assistance.csv')
# combineResults(directory_path, '/need assistance','need assistance.csv')
```



```{r adl items - indoormoving}
directory_path <- 'D:\\DiXi\\data preparation\\environmental info\\single events identification\\heat and cold\\using threshold 5 years prior to exposure\\modelling\\result\\subgroup analysis\\detailed items\\ADL2\\indoormoving'
setwd(directory_path)

getSubGroup.prov(HW1_CMA_full, 'indoormoving', 'HW1')
getSubGroup.prov(HW2_WMO_90TH_1D_full, 'indoormoving', 'HW2')
getSubGroup.prov(HW3_WMO_90TH_2D_full, 'indoormoving', 'HW3')
getSubGroup.prov(HW4_WMO_90TH_3D_full, 'indoormoving', 'HW4')
getSubGroup.prov(HW5_WMO_95TH_1D_full, 'indoormoving', 'HW5')
getSubGroup.prov(HW6_WMO_95TH_2D_full, 'indoormoving', 'HW6')
getSubGroup.prov(HW7_WMO_95TH_3D_full, 'indoormoving', 'HW7')
getSubGroup.prov(HW8_NOAA_10C_1D_full, 'indoormoving', 'HW8')
getSubGroup.prov(HW9_NOAA_10C_2D_full, 'indoormoving', 'HW9')
getSubGroup.prov(HW10_NOAA_10C_3D_full, 'indoormoving', 'HW10')

getCSV(directory_path)
# combineResults(directory_path, '/without assistance', 'without assistance.csv')
# combineResults(directory_path, '/need assistance','need assistance.csv')
```


```{r adl items - continence}
directory_path <- 'D:\\DiXi\\data preparation\\environmental info\\single events identification\\heat and cold\\using threshold 5 years prior to exposure\\modelling\\result\\subgroup analysis\\detailed items\\ADL2\\continence'
setwd(directory_path)
# 
getSubGroup.prov(HW1_CMA_full, 'continence', 'HW1')
getSubGroup.prov(HW2_WMO_90TH_1D_full, 'continence', 'HW2')
getSubGroup.prov(HW3_WMO_90TH_2D_full, 'continence', 'HW3')
getSubGroup.prov(HW4_WMO_90TH_3D_full, 'continence', 'HW4')
getSubGroup.prov(HW5_WMO_95TH_1D_full, 'continence', 'HW5')
getSubGroup.prov(HW6_WMO_95TH_2D_full, 'continence', 'HW6')
getSubGroup.prov(HW7_WMO_95TH_3D_full, 'continence', 'HW7')
getSubGroup.prov(HW8_NOAA_10C_1D_full, 'continence', 'HW8')
getSubGroup.prov(HW9_NOAA_10C_2D_full, 'continence', 'HW9')
getSubGroup.prov(HW10_NOAA_10C_3D_full, 'continence', 'HW10')




getCSV(directory_path)
# combineResults(directory_path, '/without assistance', 'without assistance.csv')
# combineResults(directory_path, '/need assistance','need assistance.csv')
```










